<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://getbootstrap.com/docs/5.3/assets/css/docs.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/solid.min.css" integrity="sha512-pZlKGs7nEqF4zoG0egeK167l6yovsuL8ap30d07kA5AJUq+WysFlQ02DLXAmN3n0+H3JVz5ni8SJZnrOaYXWBA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/brands.min.css" integrity="sha512-8RxmFOVaKQe/xtg6lbscU9DU0IRhURWEuiI0tXevv+lXbAHfkpamD4VKFQRto9WgfOJDwOZ74c/s9Yesv3VvIQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/fontawesome.min.css" integrity="sha512-d0olNN35C6VLiulAobxYHZiXJmq+vl+BGIgAxQtD5+kqudro/xNMvv2yIHAciGHpExsIbKX3iLg+0B6d0k4+ZA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <title>Instagram Bootstrap</title>

  <style>
  </style>

</head>
<body>
  
  <div class="container-fluid" id="container">

    <div class="row justify-content-between align-items-center bg-secondary bg-opacity-10 pt-2 pb-2 mb-2">
      <div class="col-auto">
        <i class="fa-brands fa-instagram"></i>
        <span class="fw-semibold">Instagram</span>
      </div>
      <div class="col-auto">
        <button type="button" class="btn btn-success text-light" data-bs-toggle="modal" data-bs-target="#exampleModal">
          Create a new post
        </button>
        
        <!-- Modal -->
        <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header">
                <h1 class="modal-title fs-5" id="exampleModalLabel">Create a new post</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body">
                <label for="exampleFormControlTextarea1" class="form-label fw-semibold">Caption:</label>
                <textarea class="form-control mb-3" id="FormControlTextarea1" rows="3" placeholder="Add the caption of your post here"></textarea>
                <button type="button" class="btn border bg-secondary bg-opacity-10">
                  <i class="fa-solid fa-camera"></i>
                </button>
                <button type="button" class="btn border bg-secondary bg-opacity-10">
                  <i class="fa-solid fa-location-dot"></i>
                </button>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-success">Publish</button>
              </div>
            </div>
          </div>
        </div>
        <div class="btn-group">
          <button type="button" class="btn btn-secondary dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
            <i class="fa-solid fa-gear"></i>
          </button>
          <ul class="dropdown-menu">
            <li><a class="dropdown-item" href="#">Profile</a></li>
            <li><a class="dropdown-item" href="#">Accesibility</a></li>
            <li><a class="dropdown-item" href="#">Privacy and Data</a></li>
            <li><hr class="dropdown-divider"></li>
            <li><a class="dropdown-item text-danger" href="#">Log out</a></li>
          </ul>
        </div>
      </div>
      
    </div>

    <!-- Change View -->
    <div class="row justify-content-center mb-4">
      <div class="col-auto text-secondary" id="buttonCells">
        <i class="fa-solid fa-table-cells"></i>
      </div>
      <div class="col-auto text-primary" id="buttonList">
        <i class="fa-solid fa-square"></i>
      </div>
    </div>



    <!-- Posts Section -->
    <div class="grid pb-3" id="postSectionCells">

      <div class="card g-col-4 card-list">
        <div class="card-header">
          <div class="row justify-content-between">
            <div class="col-auto">
              <span class="fs-5 text fw-semibold mb-0">Card title</span>
            </div>
            <div class="col-auto">
              <span class="mb-0 d-none d-md-block">08/20</span>
            </div>
          </div>
        </div>
        <img src="./imgs/img_1.jpg" class="" alt="...">
        <div class="card-body mb-0">
          <p class="card-text mb-1 fw-semibold">204 Likes</p>
          <p class="card-text mb-0">Some quick example text to build on the card title and make up the bulk of the card's content.</p>
        </div>
      </div>

    </div>

    <!-- Posts Section -->
    <!-- <div class="row row-cols-1 justify-content-center pb-3 rowContainer" id="postSectionList">

      <div class="col-sm-12 col-md-6 col-lg-5 col-xl-4 colCardContainer">
        <div class="card g-col-4 card-list">
          <div class="card-header">
            <div class="row justify-content-between">
              <div class="col-auto">
                <span class="fs-5 text fw-semibold mb-0">Card title</span>
              </div>
              <div class="col-auto">
                <span class="mb-0 d-none d-md-block">08/20</span>
              </div>
            </div>
          </div>
          <img src="./imgs/img_1.jpg" class="" alt="...">
          <div class="card-body mb-0">
            <p class="card-text mb-1 fw-semibold">204 Likes</p>
            <p class="card-text mb-0">Some quick example text to build on the card title and make up the bulk of the card's content.</p>
          </div>
        </div>
      </div>

    </div> -->

  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    const postSectionCells = document.querySelector("#post-section")
    const buttonCells = document.querySelector("#buttonCells")
    const buttonList = document.querySelector("#buttonList")
    
    let isList = true

    const infiniteScroll = true
    let lastScrollTop = 0
    let data = {}
    
    // functions
    const getData = async () => {
      const data = await fetch("./data.json")
      const jsonData = await data.json()
  
      return {
        images: jsonData.images,
        titles: jsonData.titles,
        texts: jsonData.texts
      }
    }

    const createItem = (url, title, id, likes, text) => {
      const img = document.createElement("img")
      let error = false
      img.src = url
      img.classList.add("img-full")

      img.onload = function() {
        const postSectionCells = document.querySelector("#post-section")
        const mainCol = document.createElement("div")
        const containerPost = document.createElement("div")
        const rowHeader = document.createElement("div")
        const colTitle = document.createElement("div")
        const colNumber = document.createElement("div")
        const rowImg = document.createElement("div")
        const colImg = document.createElement("div")
        const rowLikes = document.createElement("div")
        const colLikes = document.createElement("div")
        const rowText = document.createElement("div")
        const colText = document.createElement("div")

        // add content
        colTitle.textContent = title
        colNumber.textContent = `${ postSectionCells.children.length + 1}/${ id }`
        colLikes.textContent = likes
        colText.textContent = text

        // add classes
        containerPost.classList.add("container")
        containerPost.classList.add("div-post")

        rowHeader.classList.add("row")
        rowHeader.classList.add("row-list")
        rowHeader.classList.add("justify-content-between")
        rowImg.classList.add("row")
        rowLikes.classList.add("row")
        rowLikes.classList.add("row-list")
        rowText.classList.add("row")
        rowText.classList.add("row-list")

        mainCol.classList.add("col")
        colTitle.classList.add("col-auto")
        colTitle.classList.add("text-overflow")
        colNumber.classList.add("col-auto")
        colImg.classList.add("col")
        colImg.classList.add("col-img")
        colLikes.classList.add("col")
        colText.classList.add("col")

        // append content
        rowHeader.appendChild(colTitle)
        rowHeader.appendChild(colNumber)

        colImg.appendChild(img)
        rowImg.appendChild(colImg)

        rowLikes.appendChild(colLikes)
        rowText.appendChild(colText)

        containerPost.appendChild(rowHeader)
        containerPost.appendChild(rowImg)
        containerPost.appendChild(rowLikes)
        containerPost.appendChild(rowText)

        mainCol.appendChild(containerPost)
        postSectionCells.appendChild(mainCol)
      }
      
    }
  
    const generateHTML = ({images, titles, texts}) => {
      const titleMax = titles.length
      const textMax = texts.length
      const randomNumber = Math.floor(Math.random() * 3)
      const likes = `${ Math.floor(Math.random() * 7) + 2 ** Math.floor(Math.random() * 9) } likes`


      if(titleMax && textMax) {
        console.log("hola")
        images.forEach((url, index) => {
          createItem(
            url = url,
            title = titles[Math.floor(Math.random() * titleMax)],
            id = images.length,
            likes,
            text = texts[Math.floor(Math.random() * textMax)]
          )
        })
      }
    }

    // listeners
    document.addEventListener("DOMContentLoaded", async function() {
      try {
        // generateHTML((await getData()))
        // data = await getData()
        // generateHTML(data)
      } catch (error) {
        console.log(error)
      }
    })
    buttonCells.addEventListener("click", () => {
      if (isList) {
        isList = false

        console.log("change to cells")

        buttonList.classList.remove("text-primary")
        buttonList.classList.add("text-secondary")
        
        buttonCells.classList.remove("text-secondary")
        buttonCells.classList.add("text-primary")

        postSectionCells.classList.remove("row-cols-1")
        postSectionCells.classList.add("row-cols-3")
        
        postSectionCells.classList.remove("is-list")
        postSectionCells.classList.add("is-cells")
      }
    })
    buttonList.addEventListener("click", () => {
      if (!isList) {
        isList = true

        console.log("change to list")

        buttonCells.classList.remove("text-primary")
        buttonCells.classList.add("text-secondary")

        buttonList.classList.remove("text-secondary")
        buttonList.classList.add("text-primary")

        postSectionCells.classList.remove("row-cols-3")
        postSectionCells.classList.add("row-cols-1")

        postSectionCells.classList.remove("is-cells")
        postSectionCells.classList.add("is-list")
      }
    })
    postSectionCells.addEventListener("scroll", () => {
      // if (postSectionCells.scrollTop > lastScrollTop) {
      //   header.classList.add("hidden")
      //   container.classList.add("hidden-box")
      // } else {
      //   header.classList.remove("hidden")
      //   container.classList.remove("hidden-box")
      // }

      if (postSectionCells.scrollTop + postSectionCells.clientHeight >= postSectionCells.scrollHeight && infiniteScroll) {
        generateHTML(data)
      }
      lastScrollTop = postSectionCells.scrollTop
    })
    // header.addEventListener("scroll", () => {
    //   if (header.scrollTop > 0) {
    //     header.classList.remove("hidden")
    //     container.classList.remove("hidden-box")
    //   }
    // })
    
  </script>
</body>
</html>