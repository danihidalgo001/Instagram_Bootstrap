<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <title>Instagram Bootstrap</title>

  <style>
    .post-section {
      overflow-y: auto;
    }
    .is-list {
      gap: 0.5em;
    }
    .is-list .div-post {
      max-width: 500px;
    }
    .is-list .div-post {
      border: 1px solid rgba(83, 83, 83, 0.5);
    }
    .col-img {
      padding: 0 !important;
    }
    .img-full {
      width: 100%;
      height: auto;
      object-fit: cover;
    }
    .is-cells .img-full {
      width: 100% !important;
      height: 300px !important;
      object-fit: cover;
    }
    .is-cells .div-post .col {
      padding: 10px !important;
    }
    .is-cells .row-list {
      display: none;
    }
    .text-overflow {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
  </style>

</head>
<body>
  <div class="container" id="container">
    <div class="row justify-content-between align-items-center">
      <div class="col">
        <i class="fa-brands fa-instagram"></i>
        Instagram
      </div>
      <div class="col-auto">
        <button type="button" class="btn bg-success text-light">
          Create a new post
        </button>
        <button type="button" class="btn bg-secondary text-light">
          <i class="fa-solid fa-gear"></i>
          <i class="fa-solid fa-caret-down"></i>
        </button>
      </div>
      
    </div>

    <!-- Change View -->
    <div class="row justify-content-center">
      <div class="col-auto text-secondary" id="change-to-cells">
        <i class="fa-solid fa-table-cells"></i>
      </div>
      <div class="col-auto text-primary" id="change-to-list">
        <i class="fa-solid fa-square"></i>
      </div>
    </div>



    <!-- Posts Section -->
    <div class="row row-cols-1 is-list" id="post-section">
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/js/all.min.js" integrity="sha512-GWzVrcGlo0TxTRvz9ttioyYJ+Wwk9Ck0G81D+eO63BaqHaJ3YZX9wuqjwgfcV/MrB2PhaVX9DkYVhbFpStnqpQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script>
    const postSection = document.querySelector("#post-section")
    const changeToCells = document.querySelector("#change-to-cells")
    const changeToList = document.querySelector("#change-to-list")
    
    let isList = true

    const infiniteScroll = true
    let lastScrollTop = 0
    let data = {}
    
    // functions
    const getData = async () => {
      const data = await fetch("./data.json")
      const jsonData = await data.json()
  
      return {
        images: jsonData.images,
        titles: jsonData.titles,
        texts: jsonData.texts
      }
    }

    const createItem = (url, title, id, likes, text) => {
      const img = document.createElement("img")
      let error = false
      img.src = url
      img.classList.add("img-full")

      img.onload = function() {
        const postSection = document.querySelector("#post-section")
        const mainCol = document.createElement("div")
        const containerPost = document.createElement("div")
        const rowHeader = document.createElement("div")
        const colTitle = document.createElement("div")
        const colNumber = document.createElement("div")
        const rowImg = document.createElement("div")
        const colImg = document.createElement("div")
        const rowLikes = document.createElement("div")
        const colLikes = document.createElement("div")
        const rowText = document.createElement("div")
        const colText = document.createElement("div")

        // add content
        colTitle.textContent = title
        colNumber.textContent = `${ postSection.children.length + 1}/${ id }`
        colLikes.textContent = likes
        colText.textContent = text

        // add classes
        containerPost.classList.add("container")
        containerPost.classList.add("div-post")

        rowHeader.classList.add("row")
        rowHeader.classList.add("row-list")
        rowHeader.classList.add("justify-content-between")
        rowImg.classList.add("row")
        rowLikes.classList.add("row")
        rowLikes.classList.add("row-list")
        rowText.classList.add("row")
        rowText.classList.add("row-list")

        mainCol.classList.add("col")
        colTitle.classList.add("col-auto")
        colTitle.classList.add("text-overflow")
        colNumber.classList.add("col-auto")
        colImg.classList.add("col")
        colImg.classList.add("col-img")
        colLikes.classList.add("col")
        colText.classList.add("col")

        // append content
        rowHeader.appendChild(colTitle)
        rowHeader.appendChild(colNumber)

        colImg.appendChild(img)
        rowImg.appendChild(colImg)

        rowLikes.appendChild(colLikes)
        rowText.appendChild(colText)

        containerPost.appendChild(rowHeader)
        containerPost.appendChild(rowImg)
        containerPost.appendChild(rowLikes)
        containerPost.appendChild(rowText)

        mainCol.appendChild(containerPost)
        postSection.appendChild(mainCol)
      }
      
    }
  
    const generateHTML = ({images, titles, texts}) => {
      const titleMax = titles.length
      const textMax = texts.length
      const randomNumber = Math.floor(Math.random() * 3)
      const likes = `${ Math.floor(Math.random() * 7) + 2 ** Math.floor(Math.random() * 9) } likes`


      if(titleMax && textMax) {
        console.log("hola")
        images.forEach((url, index) => {
          createItem(
            url = url,
            title = titles[Math.floor(Math.random() * titleMax)],
            id = images.length,
            likes,
            text = texts[Math.floor(Math.random() * textMax)]
          )
        })
      }
    }

    // listeners
    document.addEventListener("DOMContentLoaded", async function() {
      try {
        // generateHTML((await getData()))
        data = await getData()
        generateHTML(data)
      } catch (error) {
        console.log(error)
      }
    })
    changeToCells.addEventListener("click", () => {
      if (isList) {
        isList = false

        console.log("change to cells")

        changeToList.classList.remove("text-primary")
        changeToList.classList.add("text-secondary")
        
        changeToCells.classList.remove("text-secondary")
        changeToCells.classList.add("text-primary")

        postSection.classList.remove("row-cols-1")
        postSection.classList.add("row-cols-3")
        
        postSection.classList.remove("is-list")
        postSection.classList.add("is-cells")
      }
    })
    changeToList.addEventListener("click", () => {
      if (!isList) {
        isList = true

        console.log("change to list")

        changeToCells.classList.remove("text-primary")
        changeToCells.classList.add("text-secondary")

        changeToList.classList.remove("text-secondary")
        changeToList.classList.add("text-primary")

        postSection.classList.remove("row-cols-3")
        postSection.classList.add("row-cols-1")

        postSection.classList.remove("is-cells")
        postSection.classList.add("is-list")
      }
    })
    postSection.addEventListener("scroll", () => {
      // if (postSection.scrollTop > lastScrollTop) {
      //   header.classList.add("hidden")
      //   container.classList.add("hidden-box")
      // } else {
      //   header.classList.remove("hidden")
      //   container.classList.remove("hidden-box")
      // }

      if (postSection.scrollTop + postSection.clientHeight >= postSection.scrollHeight && infiniteScroll) {
        generateHTML(data)
      }
      lastScrollTop = postSection.scrollTop
    })
    // header.addEventListener("scroll", () => {
    //   if (header.scrollTop > 0) {
    //     header.classList.remove("hidden")
    //     container.classList.remove("hidden-box")
    //   }
    // })
    
  </script>
</body>
</html>